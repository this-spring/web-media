<!--
 * @Author: xiuquanxu
 * @Company: kaochong
 * @Date: 2021-06-02 18:41:36
 * @LastEditors: xiuquanxu
 * @LastEditTime: 2021-06-03 14:46:22
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <p>libyuv</p>
    <canvas id="rgba" width="1280" height="720"></canvas>
</body>
</html>
<script>
    function onRuntimeInitialized() {
        console.log('onRuntimeInitialized success');
        rgbaToYuv = wasmDsp.cwrap('ConvertRGBA88882YUV420P', 'number', ['number', 'number', 'number', 'number']);
        yuvToRgba = wasmDsp.cwrap('ConvertYUV420P2RGBA8888', 'number', ['number', 'number', 'number', 'number']);
        fetchYuv();
    }
</script>
<script src="./wasm/LibYUV.js"></script>
<script type="module">
    import { DrawRgba } from '../../help/draw-rgba.js';
    let rgbaToYuv = null;
    let yuvToRgba = null;
    let wasmDsp = null;
    let malloc = null;
    let free = null;
    let width = 1280;
    let height = 720;
    const canvas = document.getElementById('rgba');
    const d = new DrawRgba(canvas);
    let req = fetch('./wasm/LibYUV.wasm').then(res => res.arrayBuffer()).then((buffer) => {

        LibYUV['wasmBinary'] = buffer;
        wasmDsp = LibYUV({ wasmBinary: LibYUV.wasmBinary });
        // rgbaToYuv = wasmDsp._ConvertRGBA88882YUV420P;
        // yuvToRgba = wasmDsp._ConvertYUV420P2RGBA8888;
      
    });
    function fetchYuv() {
        fetch('../../data/1280-720-yuv.raw').then(res => res.arrayBuffer()).then(buffer => {
            console.log(buffer);
            d.play(new Uint8Array(buffer), 1280, 720);
        });
    }
</script>